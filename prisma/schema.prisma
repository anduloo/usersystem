generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id                 Int                 @id @default(autoincrement())
  email              String              @unique
  password           String
  name               String?
  role               String              @default("USER")
  wechatOpenId       String?             @unique
  createdAt          DateTime            @default(now())
  updatedAt          DateTime            @updatedAt
  isActive           Boolean             @default(true)
  isSuperAdmin       Boolean             @default(false)
  projectAssignments ProjectAssignment[]
}

model Project {
  id                 Int                 @id @default(autoincrement())
  name               String              @unique
  description        String?
  url                String?
  projectAssignments ProjectAssignment[]
  userProjectAccessLogs UserProjectAccessLog[]
}

model ProjectAssignment {
  userId     Int
  projectId  Int
  assignedAt DateTime @default(now())
  assignedBy String?
  project    Project  @relation(fields: [projectId], references: [id])
  user       User     @relation(fields: [userId], references: [id])

  @@id([userId, projectId])
}

model AdminLog {
  id         Int      @id @default(autoincrement())
  adminId    Int
  action     String
  targetType String
  targetId   Int?
  detail     String?
  createdAt  DateTime @default(now())
}

model UserLoginLog {
  id        Int      @id @default(autoincrement())
  userId    Int
  ip        String?
  userAgent String?
  city      String?
  createdAt DateTime @default(now())
}

model UserProjectAccessLog {
  id        Int      @id @default(autoincrement())
  userId    Int
  projectId Int
  ip        String?
  userAgent String?
  createdAt DateTime @default(now())
  city      String?  @db.VarChar

  project   Project  @relation(fields: [projectId], references: [id])
}

model Message {
  id         Int      @id @default(autoincrement())
  title      String
  content    String
  fromUserId Int?     // 发送人，系统消息可为 null
  toUserId   Int?     // 接收人，null 表示全体用户
  isRead     Boolean  @default(false)
  createdAt  DateTime @default(now())
}