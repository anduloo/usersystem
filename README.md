# ç”¨æˆ·ç®¡ç†ç³»ç»Ÿåç«¯ (User Management System Backend)

ä¸€ä¸ªåŸºäºNode.js + Express + Prisma + PostgreSQLçš„å®Œæ•´ç”¨æˆ·ç®¡ç†ç³»ç»Ÿåç«¯ï¼Œæ”¯æŒå•ç‚¹ç™»å½•(SSO)ã€ç”¨æˆ·ç®¡ç†ã€é¡¹ç›®ç®¡ç†ã€æƒé™æ§åˆ¶å’Œæ“ä½œæ—¥å¿—ç­‰åŠŸèƒ½ã€‚

## ğŸš€ åŠŸèƒ½ç‰¹æ€§

### æ ¸å¿ƒåŠŸèƒ½
- âœ… **ç”¨æˆ·è®¤è¯ç³»ç»Ÿ** - å®Œæ•´çš„ç™»å½•/æ³¨å†Œ/ç™»å‡ºåŠŸèƒ½
- âœ… **å•ç‚¹ç™»å½•(SSO)** - æ”¯æŒè·¨åŸŸå’Œè¿œç¨‹æœåŠ¡å™¨é›†æˆ
- âœ… **ç”¨æˆ·ç®¡ç†** - ç”¨æˆ·CRUDã€è§’è‰²ç®¡ç†ã€çŠ¶æ€æ§åˆ¶
- âœ… **é¡¹ç›®ç®¡ç†** - é¡¹ç›®åˆ›å»ºã€ç¼–è¾‘ã€åˆ é™¤
- âœ… **æƒé™æ§åˆ¶** - ç»†ç²’åº¦çš„é¡¹ç›®è®¿é—®æƒé™ç®¡ç†
- âœ… **æ“ä½œæ—¥å¿—** - å®Œæ•´çš„æ“ä½œå®¡è®¡æ—¥å¿—
- âœ… **ç™»å½•æ—¥å¿—** - ç”¨æˆ·ç™»å½•è®°å½•å’Œåœ°ç†ä½ç½®è¿½è¸ª
- âœ… **è®¿é—®æ—¥å¿—** - é¡¹ç›®è®¿é—®è®°å½•å’Œç»Ÿè®¡

### æŠ€æœ¯ç‰¹æ€§
- ğŸ” **JWTè®¤è¯** - å®‰å…¨çš„Tokenè®¤è¯æœºåˆ¶
- ğŸŒ **CORSæ”¯æŒ** - å®Œæ•´çš„è·¨åŸŸèµ„æºå…±äº«é…ç½®
- ğŸ“Š **æ•°æ®ç»Ÿè®¡** - Dashboardæ•°æ®æ¦‚è§ˆå’Œå›¾è¡¨
- ğŸ” **æœç´¢åŠŸèƒ½** - ç”¨æˆ·å’Œæ—¥å¿—çš„æœç´¢è¿‡æ»¤
- ğŸ“„ **åˆ†é¡µæ”¯æŒ** - æ‰€æœ‰åˆ—è¡¨é¡µé¢çš„åˆ†é¡µåŠŸèƒ½
- ğŸ¨ **ç°ä»£UI** - å“åº”å¼è®¾è®¡å’Œç¾è§‚çš„ç•Œé¢
- ğŸ“± **ç§»åŠ¨é€‚é…** - æ”¯æŒç§»åŠ¨ç«¯è®¿é—®

## ğŸ“ é¡¹ç›®ç»“æ„

```
server/
â”œâ”€â”€ src/                 # æºä»£ç 
â”‚   â”œâ”€â”€ controllers/     # æ§åˆ¶å™¨
â”‚   â”‚   â”œâ”€â”€ authController.js
â”‚   â”‚   â”œâ”€â”€ userController.js
â”‚   â”‚   â””â”€â”€ projectController.js
â”‚   â”œâ”€â”€ routes/          # è·¯ç”±
â”‚   â”‚   â”œâ”€â”€ authRoutes.js
â”‚   â”‚   â”œâ”€â”€ userRoutes.js
â”‚   â”‚   â””â”€â”€ projectRoutes.js
â”‚   â”œâ”€â”€ middlewares/     # ä¸­é—´ä»¶
â”‚   â”‚   â””â”€â”€ authMiddleware.js
â”‚   â”œâ”€â”€ utils/           # å·¥å…·å‡½æ•°
â”‚   â””â”€â”€ index.js         # ä¸»å…¥å£æ–‡ä»¶
â”œâ”€â”€ prisma/              # æ•°æ®åº“é…ç½®
â”‚   â”œâ”€â”€ schema.prisma    # æ•°æ®åº“æ¨¡å¼
â”‚   â””â”€â”€ migrations/      # æ•°æ®åº“è¿ç§»
â”œâ”€â”€ views/               # EJSæ¨¡æ¿
â”‚   â”œâ”€â”€ admin.ejs        # ç®¡ç†åå°
â”‚   â”œâ”€â”€ portal.ejs       # ç”¨æˆ·é—¨æˆ·
â”‚   â””â”€â”€ login.ejs        # ç™»å½•é¡µé¢
â”œâ”€â”€ css/                 # æ ·å¼æ–‡ä»¶
â”‚   â”œâ”€â”€ admin.css        # ç®¡ç†åå°æ ·å¼
â”‚   â”œâ”€â”€ portal.css       # ç”¨æˆ·é—¨æˆ·æ ·å¼
â”‚   â””â”€â”€ login.css        # ç™»å½•é¡µé¢æ ·å¼
â”œâ”€â”€ public/              # é™æ€èµ„æº
â”‚   â””â”€â”€ js/              # JavaScriptæ–‡ä»¶
â”‚       â”œâ”€â”€ sso-sdk.js   # SSOå®¢æˆ·ç«¯SDK
â”‚       â””â”€â”€ *.html       # ç¤ºä¾‹é¡µé¢
â””â”€â”€ package.json         # é¡¹ç›®é…ç½®
```

## ğŸ› ï¸ æŠ€æœ¯æ ˆ

### åç«¯
- **Node.js** - JavaScriptè¿è¡Œæ—¶
- **Express.js** - Webåº”ç”¨æ¡†æ¶
- **Prisma** - æ•°æ®åº“ORM
- **PostgreSQL** - å…³ç³»å‹æ•°æ®åº“
- **JWT** - JSON Web Tokenè®¤è¯
- **bcrypt** - å¯†ç åŠ å¯†
- **cors** - è·¨åŸŸèµ„æºå…±äº«

### å‰ç«¯
- **EJS** - æ¨¡æ¿å¼•æ“
- **CSS3** - æ ·å¼è®¾è®¡
- **JavaScript** - å®¢æˆ·ç«¯è„šæœ¬
- **Font Awesome** - å›¾æ ‡åº“

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. ç¯å¢ƒè¦æ±‚
- Node.js 16+
- PostgreSQL 12+
- npm æˆ– yarn

### 2. å…‹éš†é¡¹ç›®
```bash
git clone https://github.com/anduloo/usersystem.git
cd usersystem/server
```

### 3. å®‰è£…ä¾èµ–
```bash
npm install

# å®‰è£…Prisma CLI
npm install -g prisma
```

### 4. é…ç½®ç¯å¢ƒå˜é‡
```bash
# å¤åˆ¶ç¯å¢ƒå˜é‡ç¤ºä¾‹æ–‡ä»¶
cp .env.example .env

# ç¼–è¾‘.envæ–‡ä»¶ï¼Œé…ç½®æ•°æ®åº“è¿æ¥å’ŒJWTå¯†é’¥
DATABASE_URL="postgresql://username:password@localhost:5432/usersystem?schema=public"
JWT_SECRET="your-super-secret-jwt-key-here"
```

### 5. æ•°æ®åº“è®¾ç½®
```bash
# ç”ŸæˆPrismaå®¢æˆ·ç«¯
npx prisma generate

# è¿è¡Œæ•°æ®åº“è¿ç§»
npx prisma migrate dev

# å¯é€‰ï¼šæŸ¥çœ‹æ•°æ®åº“
npx prisma studio
```

### 6. å¯åŠ¨æœåŠ¡å™¨
```bash
# å¼€å‘æ¨¡å¼
npm run dev

# ç”Ÿäº§æ¨¡å¼
npm start
```

### 7. è®¿é—®åº”ç”¨
- ç®¡ç†åå°: http://localhost:3001/admin
- ç”¨æˆ·é—¨æˆ·: http://localhost:3001/portal
- ç™»å½•é¡µé¢: http://localhost:3001/login

## ğŸ“– ä½¿ç”¨æŒ‡å—

### ç®¡ç†å‘˜åŠŸèƒ½
1. **Dashboard** - æŸ¥çœ‹ç³»ç»Ÿæ¦‚è§ˆå’Œç»Ÿè®¡æ•°æ®
2. **ç”¨æˆ·ç®¡ç†** - ç®¡ç†ç”¨æˆ·è´¦æˆ·ã€è§’è‰²å’Œæƒé™
3. **é¡¹ç›®ç®¡ç†** - åˆ›å»ºå’Œç®¡ç†é¡¹ç›®
4. **æ“ä½œæ—¥å¿—** - æŸ¥çœ‹ç®¡ç†å‘˜æ“ä½œè®°å½•
5. **ç™»å½•æ—¥å¿—** - æŸ¥çœ‹ç”¨æˆ·ç™»å½•è®°å½•
6. **è®¿é—®æ—¥å¿—** - æŸ¥çœ‹é¡¹ç›®è®¿é—®è®°å½•

### ç”¨æˆ·åŠŸèƒ½
1. **ç™»å½•/æ³¨å†Œ** - ç”¨æˆ·è®¤è¯
2. **é¡¹ç›®è®¿é—®** - æŸ¥çœ‹æœ‰æƒé™çš„é¡¹ç›®
3. **ä¸ªäººä¿¡æ¯** - ç®¡ç†ä¸ªäººèµ„æ–™

### SSOé›†æˆ
ç³»ç»Ÿæä¾›äº†å®Œæ•´çš„SSO SDKï¼Œæ”¯æŒï¼š
- è¿œç¨‹æœåŠ¡å™¨é›†æˆ
- è·¨åŸŸè°ƒç”¨
- é¡¹ç›®æƒé™éªŒè¯
- äº‹ä»¶ç›‘å¬

è¯¦ç»†é›†æˆæ–‡æ¡£è¯·å‚è€ƒï¼š`public/js/README.md`

## ğŸ”§ é…ç½®è¯´æ˜

### æ•°æ®åº“é…ç½®
```sql
-- ä¸»è¦æ•°æ®è¡¨
users           -- ç”¨æˆ·è¡¨
projects        -- é¡¹ç›®è¡¨
user_projects   -- ç”¨æˆ·é¡¹ç›®å…³è”è¡¨
admin_logs      -- ç®¡ç†å‘˜æ“ä½œæ—¥å¿—
login_logs      -- ç”¨æˆ·ç™»å½•æ—¥å¿—
access_logs     -- é¡¹ç›®è®¿é—®æ—¥å¿—
```

### CORSé…ç½®
ç³»ç»Ÿå·²é…ç½®æ”¯æŒè·¨åŸŸè®¿é—®ï¼Œå¯åœ¨ `src/index.js` ä¸­ä¿®æ”¹å…è®¸çš„åŸŸåï¼š

```javascript
const allowedOrigins = [
  'http://localhost:3000',
  'https://your-domain.com',
  'https://client-app.com'
];
```

### JWTé…ç½®
- Tokenè¿‡æœŸæ—¶é—´ï¼š24å°æ—¶
- åˆ·æ–°æœºåˆ¶ï¼šè‡ªåŠ¨å¤„ç†
- å®‰å…¨å­˜å‚¨ï¼šlocalStorage

## ğŸ“Š APIæ–‡æ¡£

### è®¤è¯ç›¸å…³
- `POST /api/auth/login` - ç”¨æˆ·ç™»å½•
- `POST /api/auth/register` - ç”¨æˆ·æ³¨å†Œ
- `POST /api/auth/logout` - ç”¨æˆ·ç™»å‡º
- `GET /api/users/me` - è·å–å½“å‰ç”¨æˆ·ä¿¡æ¯

### ç”¨æˆ·ç®¡ç†
- `GET /api/users` - è·å–ç”¨æˆ·åˆ—è¡¨
- `POST /api/users` - åˆ›å»ºç”¨æˆ·
- `PUT /api/users/:id` - æ›´æ–°ç”¨æˆ·
- `DELETE /api/users/:id` - åˆ é™¤ç”¨æˆ·
- `PATCH /api/users/:id/activate` - æ¿€æ´»ç”¨æˆ·
- `PATCH /api/users/:id/deactivate` - ç¦ç”¨ç”¨æˆ·

### é¡¹ç›®ç®¡ç†
- `GET /api/projects` - è·å–é¡¹ç›®åˆ—è¡¨
- `POST /api/projects` - åˆ›å»ºé¡¹ç›®
- `PUT /api/projects/:id` - æ›´æ–°é¡¹ç›®
- `DELETE /api/projects/:id` - åˆ é™¤é¡¹ç›®
- `POST /api/projects/assign` - åˆ†é…é¡¹ç›®æƒé™
- `POST /api/projects/revoke` - æ’¤é”€é¡¹ç›®æƒé™

### æ—¥å¿—æŸ¥è¯¢
- `GET /api/users/admin-logs` - ç®¡ç†å‘˜æ“ä½œæ—¥å¿—
- `GET /api/users/admin/user-login-logs` - ç”¨æˆ·ç™»å½•æ—¥å¿—
- `GET /api/users/admin/user-project-access-logs` - é¡¹ç›®è®¿é—®æ—¥å¿—

## ğŸ”’ å®‰å…¨ç‰¹æ€§

- **å¯†ç åŠ å¯†** - ä½¿ç”¨bcryptåŠ å¯†å­˜å‚¨
- **JWTè®¤è¯** - å®‰å…¨çš„Tokenæœºåˆ¶
- **CORSä¿æŠ¤** - ç²¾ç¡®çš„è·¨åŸŸæ§åˆ¶
- **è¾“å…¥éªŒè¯** - å®Œæ•´çš„å‚æ•°éªŒè¯
- **SQLæ³¨å…¥é˜²æŠ¤** - ä½¿ç”¨Prisma ORM
- **XSSé˜²æŠ¤** - è¾“å‡ºè½¬ä¹‰å’ŒCSP

## ğŸš€ éƒ¨ç½²æŒ‡å—

### Dockeréƒ¨ç½²
```bash
# æ„å»ºé•œåƒ
docker build -t usersystem .

# è¿è¡Œå®¹å™¨
docker run -p 3001:3001 usersystem
```

### ä¼ ç»Ÿéƒ¨ç½²
1. é…ç½®Nginxåå‘ä»£ç†
2. ä½¿ç”¨PM2ç®¡ç†è¿›ç¨‹
3. é…ç½®SSLè¯ä¹¦
4. è®¾ç½®ç¯å¢ƒå˜é‡

è¯¦ç»†éƒ¨ç½²æ–‡æ¡£è¯·å‚è€ƒï¼š`DEPLOYMENT.md`

## ğŸ¤ è´¡çŒ®æŒ‡å—

1. Fork é¡¹ç›®
2. åˆ›å»ºåŠŸèƒ½åˆ†æ”¯ (`git checkout -b feature/AmazingFeature`)
3. æäº¤æ›´æ”¹ (`git commit -m 'Add some AmazingFeature'`)
4. æ¨é€åˆ°åˆ†æ”¯ (`git push origin feature/AmazingFeature`)
5. æ‰“å¼€ Pull Request

## ğŸ“ æ›´æ–°æ—¥å¿—

### v1.0.0 (2025-7-1)
- âœ… åˆå§‹ç‰ˆæœ¬å‘å¸ƒ
- âœ… å®Œæ•´çš„ç”¨æˆ·ç®¡ç†ç³»ç»Ÿ
- âœ… SSOåŠŸèƒ½å®ç°
- âœ… æƒé™æ§åˆ¶ç³»ç»Ÿ
- âœ… æ—¥å¿—å®¡è®¡åŠŸèƒ½
- âœ… ç°ä»£åŒ–UIè®¾è®¡
- âœ… è·¨åŸŸæ”¯æŒ
- âœ… å®Œæ•´çš„æ–‡æ¡£

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ MIT è®¸å¯è¯ - æŸ¥çœ‹ [LICENSE](LICENSE) æ–‡ä»¶äº†è§£è¯¦æƒ…

## ğŸ“ è”ç³»æ–¹å¼

- é¡¹ç›®åœ°å€: https://github.com/anduloo/usersystem
- é—®é¢˜åé¦ˆ: [Issues](https://github.com/anduloo/usersystem/issues)
- åŠŸèƒ½å»ºè®®: [Discussions](https://github.com/anduloo/usersystem/discussions)

## ğŸ™ è‡´è°¢

æ„Ÿè°¢æ‰€æœ‰ä¸ºè¿™ä¸ªé¡¹ç›®åšå‡ºè´¡çŒ®çš„å¼€å‘è€…å’Œç”¨æˆ·ï¼

---

â­ å¦‚æœè¿™ä¸ªé¡¹ç›®å¯¹æ‚¨æœ‰å¸®åŠ©ï¼Œè¯·ç»™æˆ‘ä»¬ä¸€ä¸ªæ˜Ÿæ ‡ï¼ 
