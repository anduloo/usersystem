# ç”¨æˆ·ç®¡ç†ç³»ç»Ÿ - å®å¡”é¢æ¿éƒ¨ç½²æŒ‡å—

## ğŸ¯ éƒ¨ç½²æ¦‚è¿°

æœ¬é¡¹ç›®æ˜¯ä¸€ä¸ªå®Œæ•´çš„ç”¨æˆ·ç®¡ç†ç³»ç»Ÿï¼ŒåŒ…å«ç®¡ç†åå°ã€ç”¨æˆ·é—¨æˆ·ã€SSOå•ç‚¹ç™»å½•ç­‰åŠŸèƒ½ã€‚æœ¬æ–‡æ¡£ä¸“é—¨ä¸ºå®å¡”é¢æ¿ç¯å¢ƒæä¾›è¯¦ç»†çš„éƒ¨ç½²æŒ‡å¯¼ã€‚

## ğŸ“¦ é¡¹ç›®ç‰¹æ€§

### æ ¸å¿ƒåŠŸèƒ½
- âœ… **ç”¨æˆ·è®¤è¯ç³»ç»Ÿ** - å®Œæ•´çš„ç™»å½•/æ³¨å†Œ/ç™»å‡ºåŠŸèƒ½
- âœ… **å•ç‚¹ç™»å½•(SSO)** - æ”¯æŒè·¨åŸŸå’Œè¿œç¨‹æœåŠ¡å™¨é›†æˆ
- âœ… **ç”¨æˆ·ç®¡ç†** - ç”¨æˆ·CRUDã€è§’è‰²ç®¡ç†ã€çŠ¶æ€æ§åˆ¶
- âœ… **é¡¹ç›®ç®¡ç†** - é¡¹ç›®åˆ›å»ºã€ç¼–è¾‘ã€åˆ é™¤
- âœ… **æƒé™æ§åˆ¶** - ç»†ç²’åº¦çš„é¡¹ç›®è®¿é—®æƒé™ç®¡ç†
- âœ… **æ“ä½œæ—¥å¿—** - å®Œæ•´çš„æ“ä½œå®¡è®¡æ—¥å¿—
- âœ… **ç™»å½•æ—¥å¿—** - ç”¨æˆ·ç™»å½•è®°å½•å’Œåœ°ç†ä½ç½®è¿½è¸ª
- âœ… **è®¿é—®æ—¥å¿—** - é¡¹ç›®è®¿é—®è®°å½•å’Œç»Ÿè®¡

### æŠ€æœ¯ç‰¹æ€§
- ğŸ” **JWTè®¤è¯** - å®‰å…¨çš„Tokenè®¤è¯æœºåˆ¶
- ğŸŒ **CORSæ”¯æŒ** - å®Œæ•´çš„è·¨åŸŸèµ„æºå…±äº«é…ç½®
- ğŸ“Š **æ•°æ®ç»Ÿè®¡** - Dashboardæ•°æ®æ¦‚è§ˆå’Œå›¾è¡¨
- ğŸ” **æœç´¢åŠŸèƒ½** - ç”¨æˆ·å’Œæ—¥å¿—çš„æœç´¢è¿‡æ»¤
- ğŸ“„ **åˆ†é¡µæ”¯æŒ** - æ‰€æœ‰åˆ—è¡¨é¡µé¢çš„åˆ†é¡µåŠŸèƒ½
- ğŸ¨ **ç°ä»£UI** - å“åº”å¼è®¾è®¡å’Œç¾è§‚çš„ç•Œé¢
- ğŸ“± **ç§»åŠ¨é€‚é…** - æ”¯æŒç§»åŠ¨ç«¯è®¿é—®

## ğŸš€ å¿«é€Ÿéƒ¨ç½²ï¼ˆæ¨èï¼‰

### ç¬¬ä¸€æ­¥ï¼šç¯å¢ƒå‡†å¤‡

1. **æœåŠ¡å™¨è¦æ±‚**
   - æ“ä½œç³»ç»Ÿï¼šCentOS 7+ / Ubuntu 18+ / Debian 9+
   - å†…å­˜ï¼šæœ€å°‘ 2GBï¼Œæ¨è 4GB+
   - ç£ç›˜ï¼šæœ€å°‘ 20GB å¯ç”¨ç©ºé—´
   - ç½‘ç»œï¼šå…¬ç½‘IPï¼ŒåŸŸåï¼ˆæ¨èï¼‰

2. **å®å¡”é¢æ¿è¦æ±‚**
   - å®å¡”é¢æ¿ç‰ˆæœ¬ï¼š7.0+
   - Nginxï¼š1.18+
   - Node.jsï¼š18.x
   - PostgreSQLï¼š12+

### ç¬¬äºŒæ­¥ï¼šä¸Šä¼ é¡¹ç›®

1. **ç™»å½•å®å¡”é¢æ¿**
   ```
   http://your-server-ip:8888
   ```

2. **åˆ›å»ºé¡¹ç›®ç›®å½•**
   - è¿›å…¥æ–‡ä»¶ç®¡ç†å™¨
   - å¯¼èˆªåˆ° `/www/wwwroot/`
   - åˆ›å»º `usersystem` æ–‡ä»¶å¤¹

3. **ä¸Šä¼ é¡¹ç›®æ–‡ä»¶**
   - å°†æ•´ä¸ª `server` ç›®å½•å†…å®¹ä¸Šä¼ åˆ° `/www/wwwroot/usersystem/`
   - ç¡®ä¿ä¿æŒç›®å½•ç»“æ„å®Œæ•´

### ç¬¬ä¸‰æ­¥ï¼šè¿è¡Œéƒ¨ç½²è„šæœ¬

```bash
# SSHè¿æ¥åˆ°æœåŠ¡å™¨
ssh root@your-server-ip

# è¿›å…¥é¡¹ç›®ç›®å½•
cd /www/wwwroot/usersystem

# è¿è¡Œå¿«é€Ÿéƒ¨ç½²è„šæœ¬
bash scripts/quick-deploy.sh
```

### ç¬¬å››æ­¥ï¼šé…ç½®ç½‘ç«™

1. **æ·»åŠ ç½‘ç«™**
   - åœ¨å®å¡”é¢æ¿ä¸­è¿›å…¥"ç½‘ç«™"ç®¡ç†
   - ç‚¹å‡»"æ·»åŠ ç«™ç‚¹"
   - å¡«å†™åŸŸåï¼ˆå¦‚ï¼šyour-domain.comï¼‰
   - é€‰æ‹©PHPç‰ˆæœ¬ï¼šçº¯é™æ€

2. **é…ç½®SSLè¯ä¹¦**
   - åœ¨ç½‘ç«™è®¾ç½®ä¸­ç”³è¯·SSLè¯ä¹¦
   - å¼€å¯"å¼ºåˆ¶HTTPS"

3. **é…ç½®Nginx**
   - åœ¨ç½‘ç«™è®¾ç½®ä¸­æ‰¾åˆ°"é…ç½®æ–‡ä»¶"
   - å°† `scripts/baota-nginx.conf` çš„å†…å®¹å¤åˆ¶è¿›å»
   - ä¿®æ”¹åŸŸåé…ç½®
   - ä¿å­˜å¹¶é‡å¯Nginx

## ğŸ”§ è¯¦ç»†é…ç½®

### ç¯å¢ƒå˜é‡é…ç½®

éƒ¨ç½²è„šæœ¬ä¼šè‡ªåŠ¨åˆ›å»º `.env` æ–‡ä»¶ï¼Œæ‚¨éœ€è¦ç¼–è¾‘ä»¥ä¸‹é…ç½®ï¼š

```bash
# æ•°æ®åº“é…ç½®
DATABASE_URL="postgresql://usersystem_user:usersystem_password_2024@localhost:5432/usersystem?schema=public"

# JWTå¯†é’¥ï¼ˆè¯·ä¿®æ”¹ä¸ºéšæœºå­—ç¬¦ä¸²ï¼‰
JWT_SECRET="your-super-secret-jwt-key-here-change-this-in-production"

# æœåŠ¡å™¨é…ç½®
PORT=3001
NODE_ENV=production

# CORSé…ç½®ï¼ˆæ›¿æ¢ä¸ºæ‚¨çš„åŸŸåï¼‰
ALLOWED_ORIGINS="https://your-domain.com,https://www.your-domain.com"

# æ—¥å¿—é…ç½®
LOG_LEVEL=info
```

### æ•°æ®åº“é…ç½®

å¦‚æœä½¿ç”¨ç¯å¢ƒå‡†å¤‡è„šæœ¬ï¼Œæ•°æ®åº“ä¼šè‡ªåŠ¨åˆ›å»ºï¼š

```bash
# æ•°æ®åº“ä¿¡æ¯
æ•°æ®åº“å: usersystem
ç”¨æˆ·å: usersystem_user
å¯†ç : usersystem_password_2024
è¿æ¥å­—ç¬¦ä¸²: postgresql://usersystem_user:usersystem_password_2024@localhost:5432/usersystem?schema=public
```

### Nginxé…ç½®

åœ¨å®å¡”é¢æ¿ç½‘ç«™è®¾ç½®ä¸­ï¼Œå°†é…ç½®æ–‡ä»¶æ›¿æ¢ä¸ºï¼š

```nginx
server {
    listen 80;
    server_name your-domain.com; # è¯·æ›¿æ¢ä¸ºæ‚¨çš„åŸŸå
    
    # é‡å®šå‘åˆ°HTTPS
    return 301 https://$server_name$request_uri;
}

server {
    listen 443 ssl http2;
    server_name your-domain.com; # è¯·æ›¿æ¢ä¸ºæ‚¨çš„åŸŸå

    # SSLè¯ä¹¦é…ç½®ï¼ˆå®å¡”é¢æ¿ä¼šè‡ªåŠ¨é…ç½®ï¼‰
    
    # å®‰å…¨å¤´
    add_header X-Frame-Options DENY;
    add_header X-Content-Type-Options nosniff;
    add_header X-XSS-Protection "1; mode=block";
    add_header Strict-Transport-Security "max-age=31536000; includeSubDomains" always;

    # ä»£ç†åˆ°Node.jsåº”ç”¨
    location / {
        proxy_pass http://localhost:3001;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_cache_bypass $http_upgrade;
    }

    # é™æ€æ–‡ä»¶ç¼“å­˜
    location ~* \.(js|css|png|jpg|jpeg|gif|ico|svg)$ {
        expires 1y;
        add_header Cache-Control "public, immutable";
        proxy_pass http://localhost:3001;
    }

    # å¥åº·æ£€æŸ¥
    location /health {
        access_log off;
        return 200 "OK";
        add_header Content-Type text/plain;
    }
}
```

## ğŸ“Š éƒ¨ç½²éªŒè¯

éƒ¨ç½²å®Œæˆåï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼éªŒè¯ï¼š

### 1. æ£€æŸ¥åº”ç”¨çŠ¶æ€
```bash
pm2 status
```

### 2. æ£€æŸ¥ç«¯å£ç›‘å¬
```bash
netstat -tlnp | grep 3001
```

### 3. è®¿é—®å¥åº·æ£€æŸ¥
```
http://localhost:3001/health
```

### 4. è®¿é—®åº”ç”¨é¡µé¢
- ç®¡ç†åå°ï¼š`http://localhost:3001/admin`
- ç”¨æˆ·é—¨æˆ·ï¼š`http://localhost:3001/portal`
- ç™»å½•é¡µé¢ï¼š`http://localhost:3001/login`

## ğŸ“Š ç›‘æ§å’Œç»´æŠ¤

### åº”ç”¨ç›‘æ§

```bash
# æŸ¥çœ‹åº”ç”¨çŠ¶æ€
pm2 status

# æŸ¥çœ‹åº”ç”¨æ—¥å¿—
pm2 logs usersystem

# ç›‘æ§é¢æ¿
pm2 monit

# é‡å¯åº”ç”¨
pm2 restart usersystem
```

### ç³»ç»Ÿç›‘æ§

```bash
# æ£€æŸ¥ç«¯å£ç›‘å¬
netstat -tlnp | grep 3001

# æ£€æŸ¥èµ„æºä½¿ç”¨
htop
df -h
free -h
```

### æ•°æ®åº“ç›‘æ§

```bash
# æ£€æŸ¥æ•°æ®åº“è¿æ¥
sudo -u postgres psql -c "SELECT * FROM pg_stat_activity;"

# æ£€æŸ¥æ•°æ®åº“å¤§å°
sudo -u postgres psql -c "SELECT pg_size_pretty(pg_database_size('usersystem'));"
```

## ğŸ”„ æ›´æ–°éƒ¨ç½²

### ä»£ç æ›´æ–°æµç¨‹

1. **å¤‡ä»½å½“å‰ç‰ˆæœ¬**
   ```bash
   cp -r /www/wwwroot/usersystem /www/wwwroot/usersystem_backup_$(date +%Y%m%d)
   ```

2. **ä¸Šä¼ æ–°ä»£ç **
   - æ›¿æ¢ `/www/wwwroot/usersystem/` ç›®å½•å†…å®¹

3. **æ›´æ–°ä¾èµ–**
   ```bash
   cd /www/wwwroot/usersystem
   npm install --production
   ```

4. **è¿è¡Œæ•°æ®åº“è¿ç§»**
   ```bash
   npx prisma migrate deploy
   ```

5. **é‡å¯åº”ç”¨**
   ```bash
   pm2 restart usersystem
   ```

### é…ç½®æ›´æ–°

```bash
# æ›´æ–°ç¯å¢ƒå˜é‡
nano /www/wwwroot/usersystem/.env

# é‡å¯åº”ç”¨
pm2 restart usersystem

# é‡å¯Nginx
nginx -s reload
```

## ğŸš¨ æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **åº”ç”¨æ— æ³•å¯åŠ¨**
   ```bash
   # æ£€æŸ¥ç«¯å£å ç”¨
   netstat -tlnp | grep 3001
   
   # æ£€æŸ¥æ—¥å¿—
   pm2 logs usersystem
   
   # æ£€æŸ¥ç¯å¢ƒå˜é‡
   cat /www/wwwroot/usersystem/.env
   ```

2. **æ•°æ®åº“è¿æ¥å¤±è´¥**
   ```bash
   # æ£€æŸ¥PostgreSQLçŠ¶æ€
   systemctl status postgresql
   
   # æµ‹è¯•æ•°æ®åº“è¿æ¥
   psql -h localhost -U usersystem_user -d usersystem
   ```

3. **Nginxé…ç½®é”™è¯¯**
   ```bash
   # æ£€æŸ¥Nginxé…ç½®
   nginx -t
   
   # æŸ¥çœ‹Nginxé”™è¯¯æ—¥å¿—
   tail -f /www/wwwlogs/your-domain.com.error.log
   ```

4. **SSLè¯ä¹¦é—®é¢˜**
   - åœ¨å®å¡”é¢æ¿ä¸­é‡æ–°ç”³è¯·SSLè¯ä¹¦
   - æ£€æŸ¥åŸŸåè§£ææ˜¯å¦æ­£ç¡®
   - ç¡®è®¤é˜²ç«å¢™å…è®¸443ç«¯å£

### æ—¥å¿—ä½ç½®

- **åº”ç”¨æ—¥å¿—**: `/www/wwwroot/usersystem/logs/`
- **PM2æ—¥å¿—**: `pm2 logs usersystem`
- **Nginxè®¿é—®æ—¥å¿—**: `/www/wwwlogs/your-domain.com.log`
- **Nginxé”™è¯¯æ—¥å¿—**: `/www/wwwlogs/your-domain.com.error.log`
- **ç³»ç»Ÿæ—¥å¿—**: `/var/log/syslog`

## ğŸ“ æŠ€æœ¯æ”¯æŒ

å¦‚æœåœ¨éƒ¨ç½²è¿‡ç¨‹ä¸­é‡åˆ°é—®é¢˜ï¼š

1. **æŸ¥çœ‹æ—¥å¿—**
   ```bash
   pm2 logs usersystem
   tail -f /www/wwwlogs/your-domain.com.error.log
   ```

2. **æ£€æŸ¥é…ç½®**
   - ç¡®è®¤ `.env` æ–‡ä»¶é…ç½®æ­£ç¡®
   - ç¡®è®¤Nginxé…ç½®æ­£ç¡®
   - ç¡®è®¤æ•°æ®åº“è¿æ¥æ­£å¸¸

3. **é‡å¯æœåŠ¡**
   ```bash
   pm2 restart usersystem
   nginx -s reload
   ```

4. **æäº¤Issue**
   - å¦‚æœé—®é¢˜æ— æ³•è§£å†³ï¼Œè¯·æäº¤Issueåˆ°GitHubé¡¹ç›®

## ğŸ‰ éƒ¨ç½²å®Œæˆ

éƒ¨ç½²å®Œæˆåï¼Œæ‚¨å¯ä»¥é€šè¿‡ä»¥ä¸‹åœ°å€è®¿é—®ï¼š

- **ç®¡ç†åå°**: https://your-domain.com/admin
- **ç”¨æˆ·é—¨æˆ·**: https://your-domain.com/portal
- **ç™»å½•é¡µé¢**: https://your-domain.com/login
- **å¥åº·æ£€æŸ¥**: https://your-domain.com/health

## ğŸ“ æ–‡ä»¶è¯´æ˜

### éƒ¨ç½²è„šæœ¬
- `scripts/quick-deploy.sh` - å¿«é€Ÿéƒ¨ç½²è„šæœ¬
- `scripts/baota-deploy.sh` - å®Œæ•´éƒ¨ç½²è„šæœ¬
- `scripts/baota-setup.sh` - ç¯å¢ƒå‡†å¤‡è„šæœ¬

### é…ç½®æ–‡ä»¶
- `scripts/baota-nginx.conf` - Nginxé…ç½®æ¨¡æ¿
- `scripts/baota-install.md` - è¯¦ç»†å®‰è£…è¯´æ˜

### æ–‡æ¡£
- `README.md` - é¡¹ç›®è¯´æ˜æ–‡æ¡£
- `DEPLOYMENT.md` - é€šç”¨éƒ¨ç½²æŒ‡å—
- `BAOTA-DEPLOY.md` - å®å¡”é¢æ¿éƒ¨ç½²æŒ‡å—
- `DEPLOY-PACKAGE.md` - éƒ¨ç½²åŒ…è¯´æ˜

## ğŸ“ æ³¨æ„äº‹é¡¹

1. **å®‰å…¨é…ç½®**
   - è¯·ä¿®æ”¹JWT_SECRETä¸ºéšæœºå­—ç¬¦ä¸²
   - é…ç½®æ­£ç¡®çš„CORSåŸŸå
   - å¯ç”¨HTTPS

2. **æ€§èƒ½ä¼˜åŒ–**
   - é…ç½®é™æ€æ–‡ä»¶ç¼“å­˜
   - å¯ç”¨Gzipå‹ç¼©
   - ç›‘æ§åº”ç”¨æ€§èƒ½

3. **å¤‡ä»½ç­–ç•¥**
   - å®šæœŸå¤‡ä»½æ•°æ®åº“
   - å¤‡ä»½åº”ç”¨ä»£ç 
   - å¤‡ä»½é…ç½®æ–‡ä»¶

---

ç¥æ‚¨éƒ¨ç½²é¡ºåˆ©ï¼ğŸš€ 